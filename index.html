<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>CS2 CCU Chart</title>
</head>
<body>
  <div style="max-width:960px;margin:16px auto">
    <canvas id="ccuChart" height="360"></canvas>
    <div id="ccuMeta" style="font:13px/1.4 system-ui;color:#555;margin-top:8px"></div>
  </div>

  <!-- Firebase compat builds -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Chart.js + date adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

  <script>
  (function () {
    const firebaseConfig = {
      apiKey: "AIzaSyBUAUZIA65lB7gsPP6UVk2PBDzoFl53Ob4",
      authDomain: "cs2-players-data.firebaseapp.com",
      projectId: "cs2-players-data"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const APPID = 730; // CS2
    const start = new Date(new Date().getFullYear(), 0, 1).getTime();

    const ref = db.collection('steam_ccu').doc(String(APPID)).collection('points');
    ref.where('ts_ms','>=',start).orderBy('ts_ms','asc').get().then(snap=>{
      const rows = snap.docs.map(d=>d.data());
      const labels = rows.map(r=>new Date(r.ts_ms));
      const data   = rows.map(r=>r.count);

      const ctx = document.getElementById('ccuChart').getContext('2d');
      new Chart(ctx, {
        type:'line',
        data:{ labels, datasets:[{ label:'CS2 Concurrent Players', data, borderWidth:2, tension:.2, pointRadius:0 }] },
        options:{ responsive:true, animation:false,
          scales:{ x:{ type:'time', time:{ unit:'day' } },
                   y:{ beginAtZero:true, ticks:{ callback:v=>Intl.NumberFormat().format(v) } } }
        }
      });
      document.getElementById('ccuMeta').textContent =
        rows.length ? `${labels[0].toLocaleDateString()} → ${labels.at(-1).toLocaleDateString()} • ${rows.length} points` :
                      'No data yet.';
    }).catch(()=>{
      document.getElementById('ccuMeta').textContent = 'Failed to load data.';
    });
  })();
  </script>
</body>
</html>
